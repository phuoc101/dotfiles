#! /usr/bin/bash

opt_all=false
opt_screen=false
opt_lock=false
opt_bg=false
opt_polybar=false
while getopts "slabp" OPTION;
do
    case "$OPTION" in
        a) 
          opt_all=true
          notify-send "INIT ALL"
          ;;
        l) 
          opt_lock=true
          ;;
        s) 
          opt_screen=true
          ;;
        b) 
          opt_bg=true
          ;;
        p) 
          opt_polybar=true
          ;;
        \?) 
          echo "Invalid option -OPTARG" >&2
          exit 1
          ;;
    esac
done

if [ "$opt_all" == true ] || [ "$opt_polybar" == true ]
then
source ~/.config/polybar/scripts/launch.sh
fi
# Start kde connect
if [ "$opt_all" == true ] || [ "$opt_bg" == true ]
then
  notify-send "INIT BACKGROUND PROGRAMS"
  echo "all: $opt_all"
  kdeconnect-indicator &
  notify-send "KDE Connect started" "Available: $(kdeconnect-cli -a --name-only)"
  # Start ALSA service (for sound)
  alsactl init;
  notify-send "ALSA initiated"
  # Launching background apps
  copyq &
  notify-send "CopyQ initiated"
  /usr/bin/syncthing serve --no-browser --logfile=default &
  notify-send "Syncthing initiated"
fi

if [ "$opt_screen" == true ] || [ "$opt_all"  == true ]
then
  notify-send "INIT SCREEN"
  init_displays
fi
#
# Update lockscreen
if [ $opt_lock == true ] || [ $opt_all == true ]
then
  MY_LOCKSCREEN=~/dotfiles/wallpapers_dark/dark_gundam6.jpg
  notify-send "INIT LOCKSCREEN"
  notify-send "Updating betterlockscreen" "$MY_LOCKSCREEN"
  betterlockscreen -u $MY_LOCKSCREEN
  notify-send "betterlockscreen updated" "$MY_LOCKSCREEN"
fi
